<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="From a matrix of spectra similarity (e.g., with the cosine metric,
or Pearson product moment), infer the species clusters based on a
threshold above (or equal to) which spectra are considered alike."><title>Delineate clusters from a similarity matrix — delineate_with_similarity • maldipickr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><script src="../extra.js"></script><meta property="og:title" content="Delineate clusters from a similarity matrix — delineate_with_similarity"><meta property="og:description" content="From a matrix of spectra similarity (e.g., with the cosine metric,
or Pearson product moment), infer the species clusters based on a
threshold above (or equal to) which spectra are considered alike."><meta property="og:image" content="https://repository-images.githubusercontent.com/613291736/be5379b5-ce72-430d-bb4c-70155ba6a0ad"><meta property="og:image:alt" content="maldipickr logo with the legend Dereplicate and cherry-pick mass spectrometry spectra"><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">maldipickr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.3.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/dereplicate-bruker-maldi-biotyper-spectra.html">Dereplicate Bruker MALDI Biotyper spectra</a>
    <a class="dropdown-item" href="../articles/import-data-from-bruker-maldi-biotyper.html">Import data from Bruker MALDI Biotyper</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <a class="dropdown-item" href="https://clavellab.github.io/maldipickr/news/index.html#maldipickr-130">Version 1.3.0</a>
    <a class="dropdown-item" href="https://clavellab.github.io/maldipickr/news/index.html#maldipickr-120">Version 1.2.0</a>
    <a class="dropdown-item" href="https://clavellab.github.io/maldipickr/news/index.html#maldipickr-111">Version 1.1.1</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ClavelLab/maldipickr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Delineate clusters from a similarity matrix</h1>
      <small class="dont-index">Source: <a href="https://github.com/ClavelLab/maldipickr/blob/HEAD/R/delineate_with_similarity.R" class="external-link"><code>R/delineate_with_similarity.R</code></a></small>
      <div class="d-none name"><code>delineate_with_similarity.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>From a matrix of spectra similarity (e.g., with the cosine metric,
or Pearson product moment), infer the species clusters based on a
threshold <strong>above</strong> (or <strong>equal to</strong>) which spectra are considered alike.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">delineate_with_similarity</span><span class="op">(</span><span class="va">sim_matrix</span>, <span class="va">threshold</span>, method <span class="op">=</span> <span class="st">"complete"</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>sim_matrix</dt>
<dd><p>A \(n \times n\) similarity matrix, with \(n\) the number of spectra. Columns should be named as the rows.</p></dd>


<dt>threshold</dt>
<dd><p>A numeric value indicating the minimal similarity between two spectra. Adjust accordingly to the similarity metric used.</p></dd>


<dt>method</dt>
<dd><p>The method of hierarchical clustering to use. The default and recommended method is "complete", but any methods from <a href="https://rdrr.io/r/stats/hclust.html" class="external-link">stats::hclust</a> are valid.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A tibble of \(n\) rows for each spectra and 3 columns:</p><ul><li><p><code>name</code>: the rownames of the similarity matrix indicating the spectra names</p></li>
<li><p><code>membership</code>: integers stating the cluster number to which the spectra belong to. It starts from 1 to \(c\), the total number of clusters.</p></li>
<li><p><code>cluster_size</code>: integers indicating the total number of spectra in the corresponding cluster.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The similarity matrix is converted to a distance matrix by subtracting the value one. This approach works for cosine similarity and positive correlations that have an upper bound of 1. Clusters are then delineated using hierarchical clustering. The default method of hierarchical clustering is the complete linkage (also known as farthest neighbor clustering) to ensure that the within-group minimum similarity of each cluster respects the threshold. See the Details section of <a href="https://rdrr.io/r/stats/hclust.html" class="external-link">stats::hclust</a> for others valid methods to use.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>For similarity metrics: <a href="https://rdrr.io/cran/coop/man/cosine.html" class="external-link"><code>coop::tcosine</code></a>, <a href="https://rdrr.io/r/stats/cor.html" class="external-link"><code><a href="https://rdrr.io/r/stats/cor.html" class="external-link">stats::cor</a></code></a>, <a href="https://rdrr.io/cran/Hmisc/man/rcorr.html" class="external-link"><code>Hmisc::rcorr</code></a>. For using taxonomic identifications for clusters : <a href="delineate_with_identification.html">delineate_with_identification</a>. For further analyses: <a href="set_reference_spectra.html">set_reference_spectra</a>.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Toy similarity matrix between the six example spectra of</span></span></span>
<span class="r-in"><span><span class="co">#  three species. The cosine metric is used and a value of</span></span></span>
<span class="r-in"><span><span class="co">#  zero indicates dissimilar spectra and a value of one</span></span></span>
<span class="r-in"><span><span class="co">#  indicates identical spectra.</span></span></span>
<span class="r-in"><span><span class="va">cosine_similarity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fl">1</span>, <span class="fl">0.79</span>, <span class="fl">0.77</span>, <span class="fl">0.99</span>, <span class="fl">0.98</span>, <span class="fl">0.98</span>,</span></span>
<span class="r-in"><span>    <span class="fl">0.79</span>, <span class="fl">1</span>, <span class="fl">0.98</span>, <span class="fl">0.79</span>, <span class="fl">0.8</span>, <span class="fl">0.8</span>,</span></span>
<span class="r-in"><span>    <span class="fl">0.77</span>, <span class="fl">0.98</span>, <span class="fl">1</span>, <span class="fl">0.77</span>, <span class="fl">0.77</span>, <span class="fl">0.77</span>,</span></span>
<span class="r-in"><span>    <span class="fl">0.99</span>, <span class="fl">0.79</span>, <span class="fl">0.77</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0.99</span>,</span></span>
<span class="r-in"><span>    <span class="fl">0.98</span>, <span class="fl">0.8</span>, <span class="fl">0.77</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>,</span></span>
<span class="r-in"><span>    <span class="fl">0.98</span>, <span class="fl">0.8</span>, <span class="fl">0.77</span>, <span class="fl">0.99</span>, <span class="fl">1</span>, <span class="fl">1</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  nrow <span class="op">=</span> <span class="fl">6</span>,</span></span>
<span class="r-in"><span>  dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="st">"species1_G2"</span>, <span class="st">"species2_E11"</span>, <span class="st">"species2_E12"</span>,</span></span>
<span class="r-in"><span>      <span class="st">"species3_F7"</span>, <span class="st">"species3_F8"</span>, <span class="st">"species3_F9"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      <span class="st">"species1_G2"</span>, <span class="st">"species2_E11"</span>, <span class="st">"species2_E12"</span>,</span></span>
<span class="r-in"><span>      <span class="st">"species3_F7"</span>, <span class="st">"species3_F8"</span>, <span class="st">"species3_F9"</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Delineate clusters based on a 0.92 threshold applied</span></span></span>
<span class="r-in"><span><span class="co">#  to the similarity matrix</span></span></span>
<span class="r-in"><span><span class="fu">delineate_with_similarity</span><span class="op">(</span><span class="va">cosine_similarity</span>, threshold <span class="op">=</span> <span class="fl">0.92</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 6 × 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   name         membership cluster_size</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> species1_G2           1            4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> species2_E11          2            2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> species2_E12          2            2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> species3_F7           1            4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> species3_F8           1            4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">6</span> species3_F9           1            4</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Charlie Pauvert, Thomas Clavel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

