<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Using the clusters information, and potential additional metadata as external
criteria, spectra are labeled as to be picked for each cluster. Note that some
spectra and therefore clusters can be explicitly removed (masked)
from the picking decision if they have been previously picked
or should be discarded, using logical columns in the metadata table.
If no metadata are provided, the reference spectra of each cluster will be picked."><title>Cherry-pick Bruker MALDI Biotyper spectra — pick_spectra • maldipickr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Cherry-pick Bruker MALDI Biotyper spectra — pick_spectra"><meta property="og:description" content="Using the clusters information, and potential additional metadata as external
criteria, spectra are labeled as to be picked for each cluster. Note that some
spectra and therefore clusters can be explicitly removed (masked)
from the picking decision if they have been previously picked
or should be discarded, using logical columns in the metadata table.
If no metadata are provided, the reference spectra of each cluster will be picked."><meta property="og:image" content="https://repository-images.githubusercontent.com/613291736/be5379b5-ce72-430d-bb4c-70155ba6a0ad"><meta property="og:image:alt" content="maldipickr logo with the legend Dereplicate and cherry-pick mass spectrometry spectra"><meta name="robots" content="noindex"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><script>
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://piwik.cebitec.uni-bielefeld.de/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '24']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script><!-- End Matomo Code --></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">maldipickr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.3.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/dereplicate-bruker-maldi-biotyper-spectra.html">Dereplicate Bruker MALDI Biotyper spectra</a>
    <a class="dropdown-item" href="../articles/import-data-from-bruker-maldi-biotyper.html">Import data from Bruker MALDI Biotyper</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <a class="dropdown-item" href="https://clavellab.github.io/maldipickr/news/index.html#maldipickr-130">Version 1.3.0</a>
    <a class="dropdown-item" href="https://clavellab.github.io/maldipickr/news/index.html#maldipickr-120">Version 1.2.0</a>
    <a class="dropdown-item" href="https://clavellab.github.io/maldipickr/news/index.html#maldipickr-111">Version 1.1.1</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ClavelLab/maldipickr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Cherry-pick Bruker MALDI Biotyper spectra</h1>
      <small class="dont-index">Source: <a href="https://github.com/ClavelLab/maldipickr/blob/HEAD/R/pick_spectra.R" class="external-link"><code>R/pick_spectra.R</code></a></small>
      <div class="d-none name"><code>pick_spectra.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Using the clusters information, and potential additional metadata as external
criteria, spectra are labeled as to be picked for each cluster. Note that some
spectra and therefore clusters can be explicitly removed (<em>masked</em>)
from the picking decision if they have been previously picked
or should be discarded, using logical columns in the metadata table.
If no metadata are provided, the reference spectra of each cluster will be picked.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pick_spectra</span><span class="op">(</span></span>
<span>  <span class="va">cluster_df</span>,</span>
<span>  metadata_df <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  criteria_column <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  hard_mask_column <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  soft_mask_column <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  is_descending_order <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  is_sorted <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>cluster_df</dt>
<dd><p>A tibble with clusters information
from the <a href="delineate_with_similarity.html">delineate_with_similarity</a> or the <a href="import_spede_clusters.html">import_spede_clusters</a> function.</p></dd>


<dt>metadata_df</dt>
<dd><p>Optional tibble with relevant metadata to guide the
picking process (e.g., OD600).</p></dd>


<dt>criteria_column</dt>
<dd><p>Optional character indicating the column in <code>metadata_df</code>
to be used as a criteria.</p></dd>


<dt>hard_mask_column</dt>
<dd><p>Column name in the <code>cluster_df</code> or <code>metadata_df</code> tibble indicating whether the spectra, <strong>and the clusters to which they belong</strong> should be discarded (<code>TRUE</code>) or not (<code>FALSE</code>) before the picking decision.</p></dd>


<dt>soft_mask_column</dt>
<dd><p>Column name in the <code>cluster_df</code> or <code>metadata_df</code> tibble indicating whether the spectra should be discarded (<code>TRUE</code>) or not (<code>FALSE</code>) before the picking decision.</p></dd>


<dt>is_descending_order</dt>
<dd><p>Optional logical indicating whether to sort the <code>criteria_column</code> from the highest-to-lowest value (<code>TRUE</code>) or lowest-to-highest (<code>FALSE</code>).</p></dd>


<dt>is_sorted</dt>
<dd><p>Optional logical to indicate that the <code>cluster_df</code> is
already sorted by cluster based on (usually multiple) internal criteria to
pick the first of each cluster. This flag is <strong>overridden</strong> if a <code>metadata_df</code>
is provided.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A tibble with as many rows as <code>cluster_df</code> with an additional logical
column named <code>to_pick</code> to indicate whether the colony associated to the spectra
should be picked. If <code>metadata_df</code> is provided, then additional columns from
this tibble are added to the returned tibble.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="delineate_with_similarity.html">delineate_with_similarity</a>, <a href="set_reference_spectra.html">set_reference_spectra</a>. For a useful utility function to soft-mask specific spectra: <a href="is_well_on_edge.html">is_well_on_edge</a>.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># 0. Load a toy example of a tibble of clusters created by</span></span></span>
<span class="r-in"><span><span class="co">#   the `delineate_with_similarity` function.</span></span></span>
<span class="r-in"><span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"clusters_tibble.RDS"</span>,</span></span>
<span class="r-in"><span>    package <span class="op">=</span> <span class="st">"maldipickr"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># 1. By default and if no other metadata are provided,</span></span></span>
<span class="r-in"><span><span class="co">#   the function picks reference spectra for each clusters.</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># N.B: The spectra `name` and `to_pick` columns are moved to the left</span></span></span>
<span class="r-in"><span><span class="co"># only for clarity using the `relocate()` function.</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="fu">pick_spectra</span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">to_pick</span><span class="op">)</span> <span class="co"># only for clarity</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 6 × 7</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   name         to_pick membership cluster_size   SNR peaks is_reference</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> species1_G2  FALSE            1            4  5.09    21 FALSE       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> species2_E11 FALSE            2            2  5.54    22 FALSE       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> species2_E12 TRUE             2            2  5.63    23 TRUE        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> species3_F7  FALSE            1            4  4.89    26 FALSE       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> species3_F8  TRUE             1            4  5.56    25 TRUE        </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">6</span> species3_F9  FALSE            1            4  5.40    25 FALSE       </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 2.1 Simulate OD600 values with uniform distribution</span></span></span>
<span class="r-in"><span><span class="co">#  for each of the colonies we measured with</span></span></span>
<span class="r-in"><span><span class="co">#  the Bruker MALDI Biotyper</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">104</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">clusters</span>,</span></span>
<span class="r-in"><span>  name <span class="op">=</span> <span class="va">name</span>, OD600 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">clusters</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">metadata</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 6 × 2</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   name         OD600</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> species1_G2  0.364</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> species2_E11 0.772</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> species2_E12 0.735</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> species3_F7  0.973</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> species3_F8  0.740</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">6</span> species3_F9  0.201</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 2.2 Pick the spectra based on the highest</span></span></span>
<span class="r-in"><span><span class="co">#   OD600 value per cluster</span></span></span>
<span class="r-in"><span><span class="fu">pick_spectra</span><span class="op">(</span><span class="va">clusters</span>, <span class="va">metadata</span>, <span class="st">"OD600"</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">to_pick</span><span class="op">)</span> <span class="co"># only for clarity</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 6 × 8</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   name         to_pick membership cluster_size   SNR peaks is_reference OD600</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> species1_G2  FALSE            1            4  5.09    21 FALSE        0.364</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> species2_E11 TRUE             2            2  5.54    22 FALSE        0.772</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> species2_E12 FALSE            2            2  5.63    23 TRUE         0.735</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> species3_F7  TRUE             1            4  4.89    26 FALSE        0.973</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> species3_F8  FALSE            1            4  5.56    25 TRUE         0.740</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">6</span> species3_F9  FALSE            1            4  5.40    25 FALSE        0.201</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 3.1 Say that the wells on the right side of the plate are</span></span></span>
<span class="r-in"><span><span class="co">#   used for negative controls and should not be picked.</span></span></span>
<span class="r-in"><span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="va">metadata</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  well <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">".*[A-Z]([0-9]{1,2}$)"</span>, <span class="st">"\\1"</span>, <span class="va">name</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/strtoi.html" class="external-link">strtoi</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  is_edge <span class="op">=</span> <span class="fu"><a href="is_well_on_edge.html">is_well_on_edge</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    well_number <span class="op">=</span> <span class="va">well</span>, plate_layout <span class="op">=</span> <span class="fl">96</span>, edges <span class="op">=</span> <span class="st">"right"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 3.2 Pick the spectra after discarding (or soft masking)</span></span></span>
<span class="r-in"><span><span class="co">#   the spectra indicated by the `is_edge` column.</span></span></span>
<span class="r-in"><span><span class="fu">pick_spectra</span><span class="op">(</span><span class="va">clusters</span>, <span class="va">metadata</span>, <span class="st">"OD600"</span>,</span></span>
<span class="r-in"><span>  soft_mask_column <span class="op">=</span> <span class="st">"is_edge"</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">to_pick</span><span class="op">)</span> <span class="co"># only for clarity</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 6 × 10</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   name      to_pick membership cluster_size   SNR peaks is_reference OD600  well</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> species1… FALSE            1            4  5.09    21 FALSE        0.364     2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> species2… TRUE             2            2  5.54    22 FALSE        0.772    11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> species2… FALSE            2            2  5.63    23 TRUE         0.735    12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> species3… TRUE             1            4  4.89    26 FALSE        0.973     7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> species3… FALSE            1            4  5.56    25 TRUE         0.740     8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">6</span> species3… FALSE            1            4  5.40    25 FALSE        0.201     9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 1 more variable: is_edge &lt;lgl&gt;</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 4.1 Say that some spectra were picked before</span></span></span>
<span class="r-in"><span><span class="co">#   (e.g., in the column F) in a previous experiment.</span></span></span>
<span class="r-in"><span><span class="co"># We do not want to pick clusters with those spectra</span></span></span>
<span class="r-in"><span><span class="co">#   included to limit redundancy.</span></span></span>
<span class="r-in"><span><span class="va">metadata</span> <span class="op">&lt;-</span> <span class="va">metadata</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  picked_before <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"_F"</span>, <span class="va">name</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># 4.2 Pick the spectra from clusters without spectra</span></span></span>
<span class="r-in"><span><span class="co">#   labeled as `picked_before` (hard masking).</span></span></span>
<span class="r-in"><span><span class="fu">pick_spectra</span><span class="op">(</span><span class="va">clusters</span>, <span class="va">metadata</span>, <span class="st">"OD600"</span>,</span></span>
<span class="r-in"><span>  hard_mask_column <span class="op">=</span> <span class="st">"picked_before"</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">to_pick</span><span class="op">)</span> <span class="co"># only for clarity</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 6 × 11</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   name      to_pick membership cluster_size   SNR peaks is_reference OD600  well</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> species1… FALSE            1            4  5.09    21 FALSE        0.364     2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> species2… TRUE             2            2  5.54    22 FALSE        0.772    11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span> species2… FALSE            2            2  5.63    23 TRUE         0.735    12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span> species3… FALSE            1            4  4.89    26 FALSE        0.973     7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span> species3… FALSE            1            4  5.56    25 TRUE         0.740     8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">6</span> species3… FALSE            1            4  5.40    25 FALSE        0.201     9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 2 more variables: is_edge &lt;lgl&gt;, picked_before &lt;lgl&gt;</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Charlie Pauvert, Thomas Clavel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

