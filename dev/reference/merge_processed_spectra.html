<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Merge multiple processed spectra and peaks — merge_processed_spectra • maldipickr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Merge multiple processed spectra and peaks — merge_processed_spectra"><meta name="description" content="Aggregate multiple processed spectra, their associated peaks and metadata into a feature matrix and a concatenated metadata table."><meta property="og:description" content="Aggregate multiple processed spectra, their associated peaks and metadata into a feature matrix and a concatenated metadata table."><meta property="og:image" content="https://repository-images.githubusercontent.com/613291736/be5379b5-ce72-430d-bb4c-70155ba6a0ad"><meta property="og:image:alt" content="maldipickr logo with the legend Dereplicate and cherry-pick mass spectrometry spectra"><meta name="robots" content="noindex"><!-- Matomo --><script>
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://piwik.cebitec.uni-bielefeld.de/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '24']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script><!-- End Matomo Code --></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">maldipickr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.3.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/maldipickr.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/dereplicate-bruker-maldi-biotyper-spectra.html">Dereplicate Bruker MALDI Biotyper spectra</a></li>
    <li><a class="dropdown-item" href="../articles/import-data-from-bruker-maldi-biotyper.html">Import data from Bruker MALDI Biotyper</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="dropdown-item" href="https://clavellab.github.io/maldipickr/news/index.html#maldipickr-130">Version 1.3.0</a></li>
    <li><a class="dropdown-item" href="https://clavellab.github.io/maldipickr/news/index.html#maldipickr-120">Version 1.2.0</a></li>
    <li><a class="dropdown-item" href="https://clavellab.github.io/maldipickr/news/index.html#maldipickr-111">Version 1.1.1</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ClavelLab/maldipickr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Merge multiple processed spectra and peaks</h1>
      <small class="dont-index">Source: <a href="https://github.com/ClavelLab/maldipickr/blob/main/R/merge_processed_spectra.R" class="external-link"><code>R/merge_processed_spectra.R</code></a></small>
      <div class="d-none name"><code>merge_processed_spectra.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Aggregate multiple processed spectra, their associated peaks and metadata into a feature matrix and a concatenated metadata table.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">merge_processed_spectra</span><span class="op">(</span></span>
<span>  <span class="va">processed_spectra</span>,</span>
<span>  remove_peakless_spectra <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  interpolate_missing <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-processed-spectra">processed_spectra<a class="anchor" aria-label="anchor" href="#arg-processed-spectra"></a></dt>
<dd><p>A <a href="https://rdrr.io/r/base/list.html" class="external-link">list</a> of the processed spectra and associated peaks and metadata in two possible formats:</p><ul><li><p>A list of <strong>in-memory objects</strong> (named <code>spectra</code>, <code>peaks</code>, <code>metadata</code>) produced by <a href="process_spectra.html">process_spectra</a>. Named lists will have names dropped, see Note.</p></li>
<li><p><a href="https://lifecycle.r-lib.org/articles/stages.html#deprecated" class="external-link"><img src="figures/lifecycle-deprecated.svg" alt="[Deprecated]"></a> A list of <strong>paths</strong> to RDS files produced by <a href="process_spectra.html">process_spectra</a> when using the <code>rds_prefix</code> option.</p></li>
</ul></dd>


<dt id="arg-remove-peakless-spectra">remove_peakless_spectra<a class="anchor" aria-label="anchor" href="#arg-remove-peakless-spectra"></a></dt>
<dd><p>A logical indicating whether to discard the spectra without detected peaks.</p></dd>


<dt id="arg-interpolate-missing">interpolate_missing<a class="anchor" aria-label="anchor" href="#arg-interpolate-missing"></a></dt>
<dd><p>A logical indicating if intensity values for missing peaks should be interpolated from the processed spectra signal or left NA which would then be converted to 0.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <em>n</em>×<em>p</em> matrix, with <em>n</em> spectra as rows and <em>p</em> features as columns that are the peaks found in all the processed spectra.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>When aggregating multiple runs of processed spectra, if a named list is
provided, note that the names will be dropped, to prevent further downstream
issues when these names were being appended to the rownames of the matrix
thus preventing downstream metadata merge.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="process_spectra.html">process_spectra</a>, the "Value" section in <a href="https://rdrr.io/cran/MALDIquant/man/intensityMatrix-functions.html" class="external-link"><code><a href="https://rdrr.io/pkg/MALDIquant/man/intensityMatrix-functions.html" class="external-link">MALDIquant::intensityMatrix</a></code></a></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Get an example directory of six Bruker MALDI Biotyper spectra</span></span></span>
<span class="r-in"><span><span class="va">directory_biotyper_spectra</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="st">"toy-species-spectra"</span>,</span></span>
<span class="r-in"><span>  package <span class="op">=</span> <span class="st">"maldipickr"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Import the six spectra</span></span></span>
<span class="r-in"><span><span class="va">spectra_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="import_biotyper_spectra.html">import_biotyper_spectra</a></span><span class="op">(</span><span class="va">directory_biotyper_spectra</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Transform the spectra signals according to Strejcek et al. (2018)</span></span></span>
<span class="r-in"><span><span class="va">processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="process_spectra.html">process_spectra</a></span><span class="op">(</span><span class="va">spectra_list</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Merge the spectra to produce the feature matrix</span></span></span>
<span class="r-in"><span><span class="va">fm</span> <span class="op">&lt;-</span> <span class="fu">merge_processed_spectra</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">processed</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># The feature matrix has 6 spectra as rows and</span></span></span>
<span class="r-in"><span><span class="co">#  35 peaks as columns</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">fm</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  6 35</span>
<span class="r-in"><span><span class="co"># Notice the difference when the interpolation is turned off</span></span></span>
<span class="r-in"><span><span class="va">fm_no_interpolation</span> <span class="op">&lt;-</span> <span class="fu">merge_processed_spectra</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">processed</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  interpolate_missing <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fm</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="co"># 0</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fm_no_interpolation</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="co"># 68</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 68</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Multiple runs can be aggregated using list()</span></span></span>
<span class="r-in"><span><span class="co"># Merge the spectra to produce the feature matrix</span></span></span>
<span class="r-in"><span><span class="va">fm_all</span> <span class="op">&lt;-</span> <span class="fu">merge_processed_spectra</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">processed</span>, <span class="va">processed</span>, <span class="va">processed</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># The feature matrix has 3×6=18 spectra as rows and</span></span></span>
<span class="r-in"><span><span class="co">#  35 peaks as columns</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">fm_all</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 18 35</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If using a list, names will be dropped and are not propagated to the matrix.</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">fm_all</span> <span class="op">&lt;-</span> <span class="fu">merge_processed_spectra</span><span class="op">(</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="va">processed</span>, <span class="st">"B"</span> <span class="op">=</span> <span class="va">processed</span>, <span class="st">"C"</span> <span class="op">=</span> <span class="va">processed</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"A|B|C"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">fm_all</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co"># FALSE</span></span></span>
<span class="r-in"><span> <span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Charlie Pauvert, Thomas Clavel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

